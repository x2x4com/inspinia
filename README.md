# flask-template
[![Build Status](https://img.shields.io/travis/derek-miller/flask-template.svg)](https://travis-ci.org/derek-miller/flask-template)
[![GitHub release](https://img.shields.io/github/release/derek-miller/flask-template.svg)]()
[![Requires.io](https://img.shields.io/requires/github/derek-miller/flask-template.svg)](https://requires.io/github/derek-miller/flask-template/requirements/?branch=master)
[![Codecov](https://img.shields.io/codecov/c/github/derek-miller/flask-template.svg)](https://codecov.io/gh/derek-miller/flask-template)
[![GitHub issues](https://img.shields.io/github/issues/derek-miller/flask-template.svg)](https://github.com/derek-miller/flask-template/issues)
[![license](https://img.shields.io/github/license/derek-miller/flask-template.svg)](https://github.com/derek-miller/flask-template/blob/master/LICENSE)

Template flask application using Flask-Admin, Flask-Security, SQLAlchemy, Sentry, and Celery among other common flask
extensions.

***

### Install

> Due to a pinned install requirements, it is recommended you use a virtualenv

```bash
git clone https://github.com/20miler10/flask-template.git
cd flask-template
python setup.py install
```

This will install the bare minimum to get the app running in your current environment.

***

### Setting Up The Database

This project uses Postgres so make sure you have it installed first. Then you can setup the db using the following
commands:

```bash
createdb flask_template
python -m flask_template.manage db upgrade
```

#### Creating A Database Revision

After making changes to the db models you can create a new version of the database using alembic:

```bash
python -m flask_template.manage db migrate -m "<short commit message>"
```

Review the migration file found in the [flask_template/migrations/versions](flask_template/migrations/versions) folder and make sure everything is correct, then run:

```bash
python -m flask_template.manage db upgrade
```

***

### Running The Flask App

There are several ways to run the app, the easiest is to use the [heroku toolbelt](https://toolbelt.heroku.com/)'s [local](https://devcenter.heroku.com/articles/heroku-local) command with a [.env.dev](.env.dev) file for configuration:

```bash
heroku local -e env.dev
```

An alternative to using the heroku toolbelt is to use [honcho](https://honcho.readthedocs.org/en/latest/):

```bash
honcho -e .env.dev start
```

Lastly you can manually run the application using your environment as your configuration:

```bash
python -m flask_template.main
# In a separate shell
celery worker -A flask_template.tasks
```

***

### Configuration

All configuration is contained in the environment. You can check the current settings with the fllowing command:

```bash
python -m flask_template.settings
```

Or retrieve a single setting:

```bash
python -m flask_template.settings <setting_name>
```

***

### Makefile Targets

> Makefile commands will only work inside a [virtualenv](https://virtualenv.pypa.io/en/latest/) or a [condaenv](http://conda.pydata.org/docs/using/envs.html)

#### `make init`

Initializes the virtualenv with an up-to-date version of setuptools, pip, and [pip-tools](https://github.com/nvie/pip-tools/).

#### `make install`

Runs [pip-compile] with `requirements-<current interpreter version>.in` then runs [pip-sync] with `requirements-<current interpreter version>.txt`

#### `make requirements-py2.txt`

Runs [pip-compile] with [requirements/python2.in](requirements/python2.in) to generate [requirements-py2.txt](requirements-py2.txt)

#### `make install-requirements-py2.txt`

Runs [pip-compile] with [requirements/install-python2.in](requirements/install-python2.in) to generate [install-requirements-py2.txt](install-requirements-py2.txt)

#### `make requirements-py3.txt`

Runs [pip-compile] with [requirements/python3.in](requirements/python3.in) to generate [requirements-py3.txt](requirements-py3.txt)

#### `make install-requirements-py3.txt`

Runs [pip-compile] with [requirements/install-python3.in](requirements/install-python3.in) to generate [install-requirements-py3.txt](install-requirements-py3.txt)

#### `make check`

Runs the `lint` and `test` targets.

#### `make lint`

Runs [pylint] on all packages in the project directory.

#### `make test`

Runs [py.test] tests located inside the tests/ folder and any test files nested in a package in the project directory. Coverage is only calculated in this target.

#### `make test-unit`

Same as `make test` excluding coverage and tests marked as `integration`.

#### `make test-integration`

Same as `make test` excluding coverage and tests **not** marked as `integration`.

#### `make build`

Builds a wheel using setuptools' bdist_wheel command. In the travis build environment the wheel is tagged with the build number (ex. 0.1.0+build1).

#### `make clean`

Cleans the project of compiled python files and files generated by the above comands such as build and dist directories.


[pylint]: https://www.pylint.org/
[py.test]: http://pytest.org/latest/
[pip-tools]: https://github.com/nvie/pip-tools/#pip-tools--pip-compile--pip-sync
[pip-compile]: https://github.com/nvie/pip-tools/#example-usage-for-pip-compile
[pip-sync]: https://github.com/nvie/pip-tools/#example-usage-for-pip-sync
